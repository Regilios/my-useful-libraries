/*!
 * AutoMenu v1.0.0
 * Adaptive horizontal menu with “More” overflow handling
 * Author: Zyryanov Kirill Andreevich / Regilios
 * License: MIT
 */
class AutoMenu{constructor(e=".mul-am",t={}){this.selector=e,this.options=Object.assign({reservePadding:25,menuHeight:56},t),this._init()}_init(){document.querySelectorAll(this.selector).forEach(e=>{requestAnimationFrame(()=>this._initMenu(e))})}_initMenu(e){const t=document.createElement("li");t.className="mul-more-am";const n=document.createElement("li");n.className="mul-clean-am";const l=document.createElement("div");l.className="mul-more-text",l.textContent="Ещё";const r=document.createElement("ul");r.className="mul-more-drop-am",t.append(l,r);let o=!1,i=null,s=null,a=null,m=null,u=null,d=null,c=null,p=null,h=0,g=0,f=!1,L=e.getBoundingClientRect().width;const v=(e,t)=>{t.style.setProperty("--height-more",this.options.menuHeight+"px"),e.addEventListener("mouseenter",()=>e.classList.add("mul-open-am")),e.addEventListener("mouseleave",()=>e.classList.remove("mul-open-am")),t.addEventListener("mouseleave",()=>{document.querySelectorAll(".mul-dropdown-menu").forEach(e=>{e.classList.remove("mul-open-dropdown")}),e.classList.remove("mul-open-am")})},y=(e,t="div")=>this._wrapContent(e,t),w=e=>this._unWrapContent(e),C=()=>this._getList(e),E=()=>{c=null,i=null,s=null,p=null,u=null,d=null},A=()=>{p||(p=C()),0!==p.length&&(u||d||(u=parseInt(getComputedStyle(p[0]).paddingLeft),d=parseInt(getComputedStyle(p[0]).paddingRight)),h=e.getBoundingClientRect().right,Array.from(p).reverse().forEach(l=>{let a=l.getBoundingClientRect().right;o&&(g=e.querySelector(".mul-more-am").getBoundingClientRect().width,a+=g+this.options.reservePadding),h<=a&&(o||(e.append(n,t),o=!0),y(l),r.prepend(l),f||(v(t,r),f=!0),i=null,s=null)}),E())},S=()=>{if(!o)return;if(i||(i=e.querySelector("ul.mul-more-drop-am li:first-child")),!i)return t.remove(),n.remove(),o=!1,f=!1,void E();let l=!1;for(;i&&(s=i.querySelector(".mul-wrapper-am"),s)&&(m=r.childNodes.length>1?n.getBoundingClientRect().width:n.getBoundingClientRect().width+g-this.options.reservePadding,a=u+d+s.getBoundingClientRect().width,m>a);){w(i),c||(c=Array.from(e.children).filter(e=>"LI"===e.tagName&&!e.classList.contains("mul-more-am")&&!e.classList.contains("mul-clean-am")));const r=e.querySelector("li.mul-clean-am")||e.querySelector("li.mul-more-am")||null;if(e.insertBefore(i,r),l=!0,i=e.querySelector("ul.mul-more-drop-am li:first-child"),!i){t.remove(),n.remove(),o=!1,f=!1;break}}l&&E()};new ResizeObserver(e=>{for(let t of e){const e=t.contentRect.width;e>L&&o?S():e<L&&A(),L=e}}).observe(e),(()=>{const t=e.querySelectorAll(".mul-dropdown");t.forEach(e=>{const t=e.querySelector(".mul-dropdown-menu");t.style.setProperty("--height-dropdown",this.options.menuHeight+"px"),e.addEventListener("click",e=>{e.target.closest(".mul-dropdown-btn")&&(e.preventDefault(),e.stopPropagation(),t.classList.toggle("mul-open-dropdown"))})}),document.addEventListener("click",e=>{t.forEach(t=>{const n=t.querySelector(".mul-dropdown-menu");t.contains(e.target)||n.classList.remove("mul-open-dropdown")})})})(),A(),e.classList.add("mul-ready")}_wrapContent(e,t="div"){if(!e||e.classList.contains("mul-inner-am"))return null;const n=document.createElement(t);n.className="mul-wrapper-am";const l=Array.from(e.children).find(e=>"UL"===e.tagName);return Array.from(e.childNodes).forEach(e=>{e!==l&&n.appendChild(e)}),e.innerHTML="",e.appendChild(n),l&&e.appendChild(l),e.classList.add("mul-inner-am"),n}_unWrapContent(e){if(!e)return null;e.classList.remove("mul-inner-am");const t=Array.from(e.children).find(e=>!!e.classList&&e.classList.contains("mul-wrapper-am")),n=Array.from(e.children).find(e=>"UL"===e.tagName);if(t){const l=Array.from(t.childNodes);e.innerHTML="",l.forEach(t=>e.appendChild(t)),n&&e.appendChild(n)}return e}_getList(e){return Array.from(e.children).filter(e=>"LI"===e.tagName&&!e.classList.contains("mul-more-am")&&!e.classList.contains("mul-clean-am"))}}document.addEventListener("DOMContentLoaded",()=>{new AutoMenu}),"undefined"!=typeof module&&(module.exports=AutoMenu);